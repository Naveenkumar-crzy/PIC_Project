
#include <xc.h>
#define _XTAL_FREQ 20000000

#define RS PORTCbits.RC0
#define RW PORTCbits.RC1
#define EN PORTCbits.RC2

#define C1 PORTBbits.RB0
#define C2 PORTBbits.RB1
#define C3 PORTBbits.RB2
#define R1 PORTBbits.RB4
#define R2 PORTBbits.RB5
#define R3 PORTBbits.RB6
#define R4 PORTBbits.RB7

void lcd_data (unsigned char data)
{
    PORTD = data;
   RS = 1;
   RW = 0;
   EN = 1;
   __delay_ms(5);
   EN = 0 ;
   
}
void lcd_cmd (unsigned char cmd)
{
    PORTD = cmd;
    RS = 0;
    RW = 0;
    EN = 1;
      __delay_ms(5);
   EN = 0 ;  
}
void lcd_string (unsigned char *str,unsigned char num)
{
    for (unsigned int i =0;i <num;i++)
    {
        lcd_data(str[i]);
    }}
    void lcd_init()
    {
        lcd_cmd(0x38);
        lcd_cmd(0x06);
        lcd_cmd(0x0C);
        lcd_cmd(0x01);
    }

void keypad()
{
    C1=1;C2=0;C3=0;
    
    if (R1 == 1)
    {
        lcd_data ('1');
    } 
 if (R2 == 1)
    {
        lcd_data ('4');
    }
 if (R3 == 1)
    {
        lcd_data ('7');
    }
 if (R4 == 1)
    {
        lcd_data ('*');
    } 
      C1=0;C2=1;C3=0;
    
    if (R1 == 1)
    {
        lcd_data ('2');
    } 
 if (R2 == 1)
    {
        lcd_data ('4');
    }
 if (R3 == 1)
    {
        lcd_data ('7');
    }
 if (R4 == 1)
    {
        lcd_data ('0');
    }
        C1=0;C2=0;C3=1;
    
    if (R1 == 1)
    {
        lcd_data ('3');
    } 
 if (R2 == 1)
    {
        lcd_data ('6');
    }
 if (R3 == 1)
    {
        lcd_data ('9');
    }
 if (R4 == 1)
    {
        lcd_data ('#');
    }
}

void main(void) {
    TRISD = 0x00;
    TRISC = 0x00;
    TRISB = 0xF0;
    
    lcd_init();
    lcd_cmd(0x80);
    lcd_string("KEY WORD",12);
    lcd_cmd(0xC0);
    while (1)
    {
    keypad();
    __delay_ms(500);
    }
    return;
}
